<div class="hub-page">
  @if (isLoading()) {
    <div class="hub-card loading">
      <lucide-icon [img]="LoaderIcon" [size]="28" class="spinner"></lucide-icon>
      <p>{{ 'PROFILE_HUB.LOADING' | translate }}</p>
    </div>
  } @else if (errorMessage()) {
    <div class="hub-card error">
      <lucide-icon [img]="WarningIcon" [size]="32"></lucide-icon>
      <h2>{{ errorMessage() | translate }}</h2>
      <button class="primary" type="button" (click)="goToEditProfile()">
        {{ 'PROFILE_HUB.ERROR_ACTION' | translate }}
      </button>
      <button class="ghost" type="button" (click)="skipToDashboard()">
        {{ 'PROFILE_HUB.ERROR_SKIP' | translate }}
      </button>
    </div>
  } @else if (profile(); as currentProfile) {
    <section class="hub-layout">
      <header class="hub-header">
        <div class="avatar" [class.placeholder]="!currentProfile.avatar_url">
          @if (currentProfile.avatar_url) {
            <img [src]="currentProfile.avatar_url" [alt]="currentProfile.nickname" />
          } @else {
            <lucide-icon [img]="AvatarIcon" [size]="48"></lucide-icon>
          }
        </div>
        <div class="headline">
          <p class="eyebrow">{{ 'PROFILE_HUB.WELCOME' | translate }}</p>
          <h1>{{ displayName() }}</h1>
          <p class="nickname">@{{ currentProfile.nickname }}</p>
          <button class="qr-button" type="button" (click)="goToQrCode()">
            <lucide-icon [img]="QrCodeIcon" [size]="18"></lucide-icon>
            <span>{{ 'PROFILE_HUB.SHOW_QR' | translate }}</span>
          </button>

          <div class="completeness" [class.low]="hasIncompleteProfile()">
            <div class="bar">
              <div class="fill" [style.width.%]="profileCompleteness()"></div>
            </div>
            <div class="label">
              <lucide-icon [img]="GaugeIcon" [size]="16"></lucide-icon>
              <span>{{ 'PROFILE_HUB.PROFILE_COMPLETE' | translate: { value: profileCompleteness() } }}</span>
            </div>
          </div>
        </div>
      </header>

      <div class="cards">
        <article class="card" (click)="goToDashboard()">
          <div class="icon">
            <lucide-icon [img]="DashboardIcon" [size]="36"></lucide-icon>
          </div>
          <h2>{{ 'PROFILE_HUB.DASHBOARD_CARD_TITLE' | translate }}</h2>
          <p>{{ 'PROFILE_HUB.DASHBOARD_CARD_DESCRIPTION' | translate }}</p>
          <span class="badge primary">{{ 'PROFILE_HUB.DASHBOARD_CARD_BADGE' | translate }}</span>
        </article>

        <article class="card" (click)="goToPublicProfile()">
          <div class="icon">
            <lucide-icon [img]="PublicIcon" [size]="36"></lucide-icon>
          </div>
          <h2>{{ 'PROFILE_HUB.PUBLIC_CARD_TITLE' | translate }}</h2>
          <p>{{ 'PROFILE_HUB.PUBLIC_CARD_DESCRIPTION' | translate }}</p>
          <span class="badge info">{{ 'PROFILE_HUB.PUBLIC_CARD_BADGE' | translate }}</span>
        </article>

        <article class="card" (click)="goToEditProfile()">
          <div class="icon">
            <lucide-icon [img]="EditIcon" [size]="36"></lucide-icon>
          </div>
          <h2>{{ 'PROFILE_HUB.EDIT_CARD_TITLE' | translate }}</h2>
          <p>{{ 'PROFILE_HUB.EDIT_CARD_DESCRIPTION' | translate }}</p>
          @if (hasIncompleteProfile()) {
            <span class="badge warn">{{ 'PROFILE_HUB.EDIT_CARD_BADGE' | translate }}</span>
          }
        </article>
      </div>

      <section class="stats">
        <div class="stat">
          <span class="value">{{ quickStats().works }}</span>
          <span class="label">{{ 'PROFILE_HUB.STATS_WORKS' | translate }}</span>
        </div>
        <div class="stat">
          <span class="value">{{ quickStats().collaborators }}</span>
          <span class="label">{{ 'PROFILE_HUB.STATS_COLLABORATORS' | translate }}</span>
        </div>
        <div class="stat">
          <span class="value">{{ quickStats().protocols }}</span>
          <span class="label">{{ 'PROFILE_HUB.STATS_PROTOCOLS' | translate }}</span>
        </div>
      </section>

      <footer class="hub-footer">
        <a routerLink="/dashboard">{{ 'PROFILE_HUB.FOOTER_SKIP' | translate }}</a>
      </footer>
    </section>
  }
</div>
