<div class="works-container">
  
  <!-- Fixed Top Bar -->
  <div class="fixed-top-bar">
    <div class="left-section">
      <button class="new-project-btn" (click)="createWork()">
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>{{ 'WORKS.ADD_WORK' | translate }}</span>
      </button>

      @if (currentWorkspace$ | async; as currentWorkspace) {
        <div class="current-project-display">
          <span class="label-text">{{ 'WORKSPACE.CURRENT' | translate }}:</span>
          <lucide-icon [img]="FolderOpen" [size]="20"></lucide-icon>
          <span class="workspace-name">{{ currentWorkspace.name }}</span>
        </div>
      }
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="navigation-tabs">
    <button class="nav-tab" (click)="navigateTo('dashboard')">
      <lucide-icon [img]="Home" [size]="20"></lucide-icon>
      <span class="tab-label">{{ 'DASHBOARD.DASHBOARD' | translate }}</span>
    </button>

    <button class="nav-tab active">
      <lucide-icon [img]="Music" [size]="20"></lucide-icon>
      <span class="tab-label">{{ 'WORKS.WORKS' | translate }}</span>
    </button>

    <button class="nav-tab" (click)="navigateTo('rights-holders')">
      <lucide-icon [img]="Users" [size]="20"></lucide-icon>
      <span class="tab-label">{{ 'RIGHTS_HOLDERS.TITLE' | translate }}</span>
    </button>

    <button class="nav-tab" (click)="navigateTo('protocols')">
      <lucide-icon [img]="FileText" [size]="20"></lucide-icon>
      <span class="tab-label">{{ 'DASHBOARD.PROTOCOLS' | translate }}</span>
    </button>

    <button class="nav-tab" (click)="navigateTo('archive')">
      <lucide-icon [img]="ArchiveIcon" [size]="20"></lucide-icon>
      <span class="tab-label">{{ 'DASHBOARD.ARCHIVE' | translate }}</span>
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <div class="search-input-wrapper">
      <lucide-icon [img]="Search" [size]="20" class="search-icon"></lucide-icon>
      <input
        type="text"
        class="search-input"
        [placeholder]="'WORKS.SEARCH_PLACEHOLDER' | translate"
        [value]="searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
      />
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>{{ 'COMMON.LOADING' | translate }}</p>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && filteredWorks().length === 0 && !searchQuery()) {
    <div class="empty-state">
      <lucide-icon [img]="Music" [size]="80" [strokeWidth]="1.5" class="empty-icon"></lucide-icon>
      <h3>{{ 'WORKS.NO_WORKS' | translate }}</h3>
      <p>{{ 'WORKS.NO_WORKS_DESCRIPTION' | translate }}</p>
      <button class="create-first-btn" (click)="createWork()">
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>{{ 'WORKS.CREATE_FIRST_WORK' | translate }}</span>
      </button>
    </div>
  }

  <!-- No Search Results -->
  @if (!isLoading() && filteredWorks().length === 0 && searchQuery()) {
    <div class="empty-state">
      <lucide-icon [img]="Search" [size]="80" [strokeWidth]="1.5" class="empty-icon"></lucide-icon>
      <h3>{{ 'WORKS.NO_RESULTS' | translate }}</h3>
      <p>{{ 'WORKS.NO_RESULTS_FOR' | translate }} "{{ searchQuery() }}"</p>
    </div>
  }

  <!-- Works Grid -->
  @if (!isLoading() && filteredWorks().length > 0) {
    <div class="works-grid">
      @for (work of filteredWorks(); track work.id) {
        <div class="work-card" (click)="editWork(work)">
          
          <!-- Card Header -->
          <div class="card-header">
            <div class="work-icon">
              <lucide-icon [img]="Music" [size]="32" [strokeWidth]="1.5"></lucide-icon>
            </div>
            <div class="work-info">
              <h3 class="work-title">{{ work.work_title }}</h3>
              @if (work.alternative_titles && work.alternative_titles.length > 0) {
                <p class="alt-title">{{ work.alternative_titles[0] }}</p>
              }
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            
            <!-- Codes -->
            <div class="work-codes">
              @if (work.isrc) {
                <span class="code-badge">ISRC: {{ work.isrc }}</span>
              }
              @if (work.iswc) {
                <span class="code-badge">ISWC: {{ work.iswc }}</span>
              }
            </div>

            <!-- Metadata -->
            <div class="work-meta">
              @if (work.duration_seconds) {
                <div class="meta-item">
                  <lucide-icon [img]="Clock" [size]="16"></lucide-icon>
                  <span>{{ formatDuration(work.duration_seconds) }}</span>
                </div>
              }
              @if (work.recording_date) {
                <div class="meta-item">
                  <lucide-icon [img]="Calendar" [size]="16"></lucide-icon>
                  <span>{{ work.recording_date | date:'mediumDate' }}</span>
                </div>
              }
              @if (work.languages && work.languages.length > 0) {
                <div class="meta-item">
                  <lucide-icon [img]="Globe" [size]="16"></lucide-icon>
                  <span>{{ work.languages[0] }}</span>
                </div>
              }
            </div>

            @if (hasAIDisclosures(work)) {
              <div class="ai-disclosure" [class.contains-ai]="hasAIInvolvement(work)">
                <div class="ai-avatar" [attr.aria-hidden]="true">
                  {{ hasAIInvolvement(work) ? 'ü§ñ' : '‚úçÔ∏è' }}
                </div>
                <div class="ai-copy">
                  <span class="ai-label">AI Disclosure</span>
                  <span class="ai-summary">{{ getAIDisclosureSummary(work) }}</span>
                </div>
              </div>
            }

            <!-- Status Badge -->
            @if (work.status) {
              <div class="status-badge" [class]="'status-' + work.status">
                {{ work.status | titlecase }}
              </div>
            }
          </div>

          <!-- Card Actions -->
          <div class="card-actions" (click)="$event.stopPropagation()">
            <button 
              class="action-btn edit" 
              (click)="editWork(work)"
              [title]="'COMMON.EDIT' | translate">
              <lucide-icon [img]="Edit" [size]="18"></lucide-icon>
            </button>
            <button 
              class="action-btn archive" 
              (click)="archiveWork(work, $event)"
              [title]="'WORKS.ARCHIVE' | translate">
              <lucide-icon [img]="Archive" [size]="18"></lucide-icon>
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>